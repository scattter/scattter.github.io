# 公网访问DDNS+IPV6

> 近期由于自己搭建了一个nas, 所以有外网访问家中路由(服务器)的需求. 最快捷的方法就是有一个公网ip, 但是现在ipv4地址有这么稀缺, 所以这一方案就暂时pass. 同时, zt和tailscale的速度也依赖于隧道两端服务器, 不够稳定, 且速度也远远达不到直连的效果, 所以就需要寻找其他方案. 
>
> ipv6是新一代的ip地址协议, 其为了解决ipv4地址不够使用的问题而诞生, 数量级相比于ipv4是N多倍, 所以几乎每个路由都有一个ipv6地址. 因此, 我们可以借用ipv6进行公网访问.

> 由于一些设备/域名还没准备好, 周末只做了一部分先加上, 其他的后续慢慢更新.



## 1. 光猫桥接

因为ipv6地址很长, 同时又不好记忆, 所以在日常网页访问过程中直接使用ipv6地址是不现实的, 这就需要用到域名来映射ipv6地址, 进行实现快捷访问, 这就是DNS( Domain Name System).

此外, 虽然每一台路由器都有一个公网ipv6地址, 但是运营商每隔一段时间会重置我们的ipv6地址, 所以我们要动态的更新我们的域名和ipv6地址的映射关系, 也就是DDNS(Dynamatic Domain Name System).

一般来讲, 我们自己配的路由器性能会更好一点, 所以为了更好的进行DDNS, 发挥路由器的效果, 我们首先需要选择ddns适配不错的路由器, 然后使用路由器进行拨号, 光猫桥接, 借助路由器的ddns将自己的域名和ipv6地址进行一个动态更新.

在这一步, 我们先进行光猫桥接, 路由器拨号的操作.



首先需要进入光猫的后台, 一般为`192.168.1.1`, 同时我们需要根据光猫的型号去网上查找超管密码, 没有超管密码改不了光猫的连接方式.

以我现在租房子移动给的`ZN-R173G` 为例:

光猫账号密码为: `CMCCAdmin`  和 `aDm8H%MdA`

除此之外, 我们还需要自己宽带的账号和密码, 这两个可以打运营商电话获取.

### 1.1 后台信息

进入路由器后台后, 我们可以看到光猫的一些连接信息, 其中表格中第一行 `4_INTERNET_R_VID_4031` 就是我们光猫和互联网连接使用的通道, 记住最后的VID: 4031, 后面我们新增桥接模式的时候要用到.

![image-20230820202156555](/Users/zhangke/Library/Application Support/typora-user-images/image-20230820202156555.png)

随后我们进入网络栏, 找到这个连接, 将所有的配置都记录下来.

![image-20230820202331325](/Users/zhangke/Library/Application Support/typora-user-images/image-20230820202331325.png)



### 1.2 光猫设置

进入网络栏后, 找到上面说的连接, 进行删除, 然后创建一个新的连接.

在出现的配置中, 选择模式为桥接, 类似下面的图, 不过这里需要把`Vlan ID` 换为上一小节记录的`VID`, 如果是4031, 那么就填4031. 其他和之前保持一致就行, 如下

![image-20230820202551416](/Users/zhangke/Library/Application Support/typora-user-images/image-20230820202551416.png)



### 1.3 路由器拨号

进入路由器的配置页面, 我这里暂时使用斐讯k2为例子, 后续有新的路由器再进行补充.

斐讯直接到上网页面设置就行了, 这里需要注意一点, 有些地方可能需要将**光猫的mac地址复制下来**, 在下面的高级设置里面设置下, 否则移动那边不响应. 保存后路由器自动重启, 此时就是路由器拨号.

![image-20230820204144491](/Users/zhangke/Library/Application Support/typora-user-images/image-20230820204144491.png)



